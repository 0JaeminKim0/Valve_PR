<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë°¸ë¸Œì¬ êµ¬ë§¤ AI Agent</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap');
        * { font-family: 'Noto Sans KR', sans-serif; }
        .mono { font-family: 'JetBrains Mono', monospace; }
        
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        /* PRD v2.0 Animations                                      */
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        @keyframes slideInLeft { 
            from { opacity: 0; transform: translateX(-30px); } 
            to { opacity: 1; transform: translateX(0); } 
        }
        @keyframes slideInUp { 
            from { opacity: 0; transform: translateY(20px); } 
            to { opacity: 1; transform: translateY(0); } 
        }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes gradientMove { 
            0% { background-position: 0% 50%; } 
            50% { background-position: 100% 50%; } 
            100% { background-position: 0% 50%; } 
        }
        
        .slide-in-left { animation: slideInLeft 0.4s ease-out forwards; }
        .slide-in-up { animation: slideInUp 0.4s ease-out forwards; }
        .fade-in { animation: fadeIn 0.5s ease-out forwards; }
        .pulse { animation: pulse 1.5s ease-in-out infinite; }
        
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        /* PRD v2.0 Agent Cards (ìƒ‰ìƒë³„ ë¶„ë¥˜)                       */
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .agent-card {
            border-radius: 12px;
            padding: 14px 18px;
            margin-bottom: 14px;
            background: rgba(30, 41, 59, 0.6);
            border-left: 4px solid;
            backdrop-filter: blur(8px);
            transition: all 0.3s ease;
        }
        .agent-card:hover { transform: translateX(4px); }
        
        /* ë°ì´í„° ìˆ˜ì§‘: íŒŒë€ìƒ‰ */
        .agent-card.data { 
            border-color: #3b82f6; 
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(30, 41, 59, 0.6) 100%);
        }
        .agent-card.data .card-icon { color: #60a5fa; }
        
        /* Rule ì ìš©: ë³´ë¼ìƒ‰ */
        .agent-card.rule { 
            border-color: #8b5cf6; 
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.1) 0%, rgba(30, 41, 59, 0.6) 100%);
        }
        .agent-card.rule .card-icon { color: #a78bfa; }
        
        /* ì›¹ê²€ìƒ‰: ì´ˆë¡ìƒ‰ */
        .agent-card.search { 
            border-color: #10b981; 
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(30, 41, 59, 0.6) 100%);
        }
        .agent-card.search .card-icon { color: #34d399; }
        
        /* LLM ë¶„ì„: ì£¼í™©ìƒ‰ */
        .agent-card.llm { 
            border-color: #f59e0b; 
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.1) 0%, rgba(30, 41, 59, 0.6) 100%);
        }
        .agent-card.llm .card-icon { color: #fbbf24; }
        
        /* íŒì • ê²°ê³¼: ìƒ‰ìƒë³„ */
        .agent-card.result-good { border-color: #10b981; background: rgba(16, 185, 129, 0.15); }
        .agent-card.result-normal { border-color: #f59e0b; background: rgba(245, 158, 11, 0.15); }
        .agent-card.result-bad { border-color: #ef4444; background: rgba(239, 68, 68, 0.15); }
        
        /* Collapsed ìƒíƒœ (ì™„ë£Œëœ ë‹¨ê³„) */
        .agent-card.collapsed {
            padding: 10px 16px;
            margin-bottom: 8px;
            opacity: 0.7;
            cursor: pointer;
        }
        .agent-card.collapsed:hover { opacity: 1; }
        .agent-card.collapsed .card-content { display: none; }
        
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        /* íƒ€ì´í•‘ íš¨ê³¼ (PRD: LLM ìŠ¤íŠ¸ë¦¬ë°)                           */
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .typing-cursor::after {
            content: 'â–Œ';
            animation: blink 0.7s infinite;
            color: #f59e0b;
            margin-left: 2px;
        }
        
        /* ìŠ¤í”¼ë„ˆ */
        .spinner {
            border: 2px solid rgba(255,255,255,0.1);
            border-top: 2px solid currentColor;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            animation: spin 0.8s linear infinite;
            display: inline-block;
        }
        .spinner-lg { width: 24px; height: 24px; border-width: 3px; }
        
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        /* ì§„í–‰ë¥  ë°” (PRD: ìƒë‹¨ Progress)                            */
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .progress-bar {
            height: 6px;
            background: rgba(255,255,255,0.1);
            border-radius: 3px;
            overflow: hidden;
        }
        .progress-bar .fill {
            height: 100%;
            background: linear-gradient(90deg, #3b82f6, #8b5cf6, #ec4899);
            background-size: 200% 100%;
            animation: gradientMove 3s ease infinite;
            transition: width 0.5s ease;
        }
        
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        /* íƒ­ ë²„íŠ¼                                                   */
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .tab-btn {
            position: relative;
            overflow: hidden;
        }
        .tab-btn.active {
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
            color: white;
            box-shadow: 0 4px 20px rgba(59, 130, 246, 0.4);
        }
        .tab-btn.active::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            animation: gradientMove 2s ease infinite;
        }
        
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        /* PRD v2.0 í…Œì´ë¸” ìŠ¤íƒ€ì¼                                    */
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .prd-table {
            font-size: 11px;
            border-collapse: separate;
            border-spacing: 0;
            width: 100%;
        }
        .prd-table thead {
            position: sticky;
            top: 0;
            z-index: 10;
        }
        .prd-table th {
            background: linear-gradient(180deg, #1e293b 0%, #0f172a 100%);
            color: #e2e8f0;
            font-weight: 600;
            padding: 12px 10px;
            text-align: center;
            border: 1px solid #334155;
            white-space: nowrap;
        }
        .prd-table th.section-header {
            background: linear-gradient(135deg, #1e40af 0%, #3730a3 100%);
            color: #fff;
            font-size: 11px;
            font-weight: 700;
            letter-spacing: 0.5px;
        }
        .prd-table td {
            padding: 12px 10px;
            border: 1px solid #334155;
            text-align: center;
            vertical-align: middle;
            background: rgba(15, 23, 42, 0.4);
        }
        .prd-table tr:nth-child(even) td { background: rgba(30, 41, 59, 0.4); }
        .prd-table tr:hover td { background: rgba(59, 130, 246, 0.15) !important; cursor: pointer; }
        .prd-table tr.expanded td { background: rgba(139, 92, 246, 0.2) !important; }
        .prd-table .text-left { text-align: left; }
        .prd-table .text-right { text-align: right; }
        .prd-table .price { font-family: 'JetBrains Mono', monospace; font-weight: 500; font-size: 11px; }
        .prd-table .highlight { background: rgba(251, 191, 36, 0.2) !important; }
        .prd-table .recommend { background: rgba(34, 197, 94, 0.2) !important; color: #4ade80; font-weight: 700; }
        
        /* ìƒì„¸ í¼ì¹¨ íŒ¨ë„ (PRD: í–‰ í´ë¦­ í™•ì¥) */
        .detail-panel {
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.9) 0%, rgba(15, 23, 42, 0.95) 100%);
            border: 1px solid rgba(139, 92, 246, 0.4);
            border-radius: 12px;
            padding: 20px;
            margin: 12px 8px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }
        
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        /* ë°°ì§€                                                     */
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .badge { 
            padding: 5px 12px; 
            border-radius: 20px; 
            font-size: 11px; 
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }
        .badge-good { background: rgba(16, 185, 129, 0.25); color: #34d399; border: 1px solid rgba(16, 185, 129, 0.4); }
        .badge-normal { background: rgba(245, 158, 11, 0.25); color: #fbbf24; border: 1px solid rgba(245, 158, 11, 0.4); }
        .badge-bad { background: rgba(239, 68, 68, 0.25); color: #f87171; border: 1px solid rgba(239, 68, 68, 0.4); }
        .badge-info { background: rgba(59, 130, 246, 0.25); color: #60a5fa; border: 1px solid rgba(59, 130, 246, 0.4); }
        
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        /* KPI ì¹´ë“œ                                                 */
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .kpi-card {
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.7) 0%, rgba(15, 23, 42, 0.9) 100%);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
        }
        .kpi-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 40px rgba(0,0,0,0.3);
            border-color: rgba(255,255,255,0.2);
        }
        .kpi-value {
            font-size: 2rem;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
            line-height: 1.2;
        }
        
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        /* ìŠ¤í¬ë¡¤ë°”                                                 */
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: rgba(255,255,255,0.02); }
        ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.15); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.25); }
        
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        /* ì°¨íŠ¸ ì»¨í…Œì´ë„ˆ                                             */
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .chart-container {
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.5) 0%, rgba(15, 23, 42, 0.7) 100%);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 16px;
            padding: 20px;
        }
        
        /* ì ì •ì„± íƒ€ì„ë¼ì¸ */
        .timeline-dot {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 12px;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .timeline-dot:hover { transform: scale(1.15); }
        .timeline-dot.good { background: linear-gradient(135deg, #10b981 0%, #059669 100%); }
        .timeline-dot.normal { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); }
        .timeline-dot.bad { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-900 via-slate-900 to-gray-900 text-white min-h-screen">
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <!-- Header (PRD: ìƒë‹¨ Progress Bar í¬í•¨)                     -->
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <header class="bg-gray-800/70 backdrop-blur-xl border-b border-gray-700/50 px-6 py-4 sticky top-0 z-50">
        <div class="max-w-[1920px] mx-auto">
            <div class="flex items-center justify-between mb-3">
                <div class="flex items-center gap-4">
                    <div class="w-12 h-12 bg-gradient-to-br from-blue-500 via-purple-500 to-pink-500 rounded-2xl flex items-center justify-center shadow-lg shadow-purple-500/30">
                        <i class="fas fa-robot text-white text-xl"></i>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold bg-gradient-to-r from-blue-400 via-purple-400 to-pink-400 bg-clip-text text-transparent">
                            ë°¸ë¸Œì¬ êµ¬ë§¤ AI Agent
                        </h1>
                        <p class="text-gray-400 text-xs">êµ¬ë§¤ ì˜ì‚¬ê²°ì • ì§€ì› ì‹œìŠ¤í…œ</p>
                    </div>
                </div>
                <div class="flex items-center gap-4">
                    <button onclick="startDemo()" id="demoBtn" class="px-6 py-2.5 bg-gradient-to-r from-blue-600 via-purple-600 to-pink-600 hover:from-blue-700 hover:via-purple-700 hover:to-pink-700 rounded-xl text-sm font-semibold transition-all shadow-lg shadow-purple-500/30 flex items-center gap-2">
                        <i class="fas fa-play"></i>
                        <span>ë¶„ì„ ì‹¤í–‰</span>
                    </button>
                    <span id="apiStatus" class="px-4 py-2 bg-yellow-500/20 text-yellow-400 rounded-full text-xs font-medium flex items-center gap-2">
                        <span class="w-2 h-2 rounded-full bg-current pulse"></span>
                        ì—°ê²° í™•ì¸ ì¤‘...
                    </span>
                </div>
            </div>
            <!-- PRD: ìƒë‹¨ Progress Bar -->
            <div class="progress-bar">
                <div id="progressFill" class="fill" style="width: 0%"></div>
            </div>
            <div class="flex justify-between mt-2 text-xs text-gray-500">
                <span id="progressStep">ëŒ€ê¸° ì¤‘</span>
                <span id="progressPercent">0%</span>
            </div>
        </div>
    </header>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <!-- Tab Navigation                                          -->
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <nav class="bg-gray-800/40 backdrop-blur px-6 py-3 border-b border-gray-700/50">
        <div class="flex gap-3 max-w-[1920px] mx-auto">
            <button onclick="switchTab(1)" class="tab-btn active px-6 py-3 rounded-xl text-sm font-semibold transition-all flex items-center gap-2" data-tab="1">
                <i class="fas fa-calculator"></i>
                PR ìµœì ë‹¨ê°€ ì œì•ˆ
            </button>
            <button onclick="switchTab(2)" class="tab-btn px-6 py-3 rounded-xl text-sm font-semibold transition-all bg-gray-700/50 hover:bg-gray-700 flex items-center gap-2" data-tab="2">
                <i class="fas fa-clipboard-check"></i>
                í˜‘ë ¥ì‚¬ ê²¬ì  ê²€ì¦
            </button>
            <button onclick="switchTab(3)" class="tab-btn px-6 py-3 rounded-xl text-sm font-semibold transition-all bg-gray-700/50 hover:bg-gray-700 flex items-center gap-2" data-tab="3">
                <i class="fas fa-chart-line"></i>
                ì›ì¬ë£Œ ì‹œí™© ë¶„ì„
            </button>
        </div>
    </nav>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <!-- Main Content: PRD v2.0 ì¢Œ40% Agent + ìš°60% ê²°ê³¼         -->
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <main class="flex h-[calc(100vh-155px)] max-w-[1920px] mx-auto">
        <!-- Left Panel: Agent ìŠ¤íŠ¸ë¦¬ë° íŒ¨ë„ (40%) -->
        <div class="w-[40%] border-r border-gray-700/50 flex flex-col bg-gradient-to-b from-gray-900/50 to-slate-900/50">
            <div class="p-4 border-b border-gray-700/50 bg-gray-800/30">
                <div class="flex items-center justify-between">
                    <h2 class="font-semibold text-sm flex items-center gap-2">
                        <i class="fas fa-brain text-purple-400"></i>
                        Agent ë¶„ì„ ê³¼ì •
                    </h2>
                    <div class="flex items-center gap-3">
                        <span id="stepCount" class="text-xs text-gray-500">0 / 0 ë‹¨ê³„</span>
                        <button onclick="collapseCompleted()" class="text-xs text-gray-400 hover:text-white transition-colors" title="ì™„ë£Œ ë‹¨ê³„ ì ‘ê¸°">
                            <i class="fas fa-compress-alt"></i>
                        </button>
                    </div>
                </div>
            </div>
            <div id="agentPanel" class="flex-1 overflow-y-auto p-4 bg-gradient-to-b from-transparent to-gray-950/30">
                <div class="text-center py-20 text-gray-500">
                    <div class="w-20 h-20 mx-auto mb-6 rounded-full bg-gray-800/50 flex items-center justify-center">
                        <i class="fas fa-robot text-4xl opacity-30"></i>
                    </div>
                    <p class="text-sm font-medium">"ë¶„ì„ ì‹¤í–‰" ë²„íŠ¼ì„ í´ë¦­í•˜ë©´</p>
                    <p class="text-sm">AI Agentê°€ ë¶„ì„ì„ ì‹œì‘í•©ë‹ˆë‹¤</p>
                    <div class="mt-4 text-xs text-gray-600">
                        <p>ë°ì´í„° ì¡°íšŒ â†’ ë‹¨ê°€ ì‚°ì¶œ â†’ AI ë¶„ì„ â†’ ì¶”ì²œ</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Panel: ê²°ê³¼ íŒ¨ë„ (60%) -->
        <div class="w-[60%] flex flex-col bg-gradient-to-b from-gray-900/30 to-slate-900/30">
            <!-- Tab 1: PR ìµœì ë‹¨ê°€ ì œì•ˆ -->
            <div id="tab1" class="tab-content flex-1 overflow-auto p-5">
                <div id="screen1-intro" class="text-center py-20 text-gray-500">
                    <div class="w-20 h-20 mx-auto mb-6 rounded-full bg-gray-800/50 flex items-center justify-center">
                        <i class="fas fa-file-invoice-dollar text-4xl opacity-30"></i>
                    </div>
                    <p class="text-sm font-medium">PR ê±´ë³„ ìµœì  ì¶”ì²œ ë‹¨ê°€ ë¶„ì„ ê²°ê³¼</p>
                    <p class="text-xs mt-2 text-gray-600">ë‹¨ê°€í…Œì´ë¸” ê¸°ë°˜ ê³„ì•½ë‹¨ê°€ + ê³¼ê±° ë°œì£¼ì‹¤ì  ê¸°ë°˜ ì˜ˆìƒë‹¨ê°€</p>
                    <div class="mt-6 grid grid-cols-3 gap-4 max-w-md mx-auto text-xs">
                        <div class="p-3 rounded-lg bg-blue-500/10 border border-blue-500/20">
                            <div class="text-blue-400 font-semibold">ê¸°ë³¸ë‹¨ê°€</div>
                            <div class="text-gray-500">BODY2</div>
                        </div>
                        <div class="p-3 rounded-lg bg-purple-500/10 border border-purple-500/20">
                            <div class="text-purple-400 font-semibold">ì˜µì…˜ë‹¨ê°€</div>
                            <div class="text-gray-500">I/O-P, LOCK ë“±</div>
                        </div>
                        <div class="p-3 rounded-lg bg-green-500/10 border border-green-500/20">
                            <div class="text-green-400 font-semibold">ê³„ì•½ë‹¨ê°€</div>
                            <div class="text-gray-500">í•©ê³„</div>
                        </div>
                    </div>
                </div>
                <div id="screen1-results" class="hidden"></div>
            </div>

            <!-- Tab 2: ê²¬ì  ê²€ì¦ -->
            <div id="tab2" class="tab-content hidden flex-1 overflow-auto p-5">
                <div id="screen2-intro" class="text-center py-20 text-gray-500">
                    <div class="w-20 h-20 mx-auto mb-6 rounded-full bg-gray-800/50 flex items-center justify-center">
                        <i class="fas fa-clipboard-check text-4xl opacity-30"></i>
                    </div>
                    <p class="text-sm font-medium">í˜‘ë ¥ì‚¬ ê²¬ì  ì ì •ì„± ê²€ì¦ ê²°ê³¼</p>
                    <p class="text-xs mt-2 text-gray-600">ë°œì£¼ì‹¤ì  ëŒ€ë¹„ ê²¬ì ê°€ ì ì •ì„± ë¶„ì„</p>
                </div>
                <div id="screen2-results" class="hidden"></div>
            </div>

            <!-- Tab 3: ì‹œí™© ë¶„ì„ -->
            <div id="tab3" class="tab-content hidden flex-1 overflow-auto p-5">
                <div id="screen3-intro" class="text-center py-20 text-gray-500">
                    <div class="w-20 h-20 mx-auto mb-6 rounded-full bg-gray-800/50 flex items-center justify-center">
                        <i class="fas fa-globe text-4xl opacity-30"></i>
                    </div>
                    <p class="text-sm font-medium">ì›ì¬ë£Œ ì‹œí™© Ã— ë°œì£¼ë‹¨ê°€ ì¢…í•© ë¶„ì„</p>
                    <p class="text-xs mt-2 text-gray-600">LME Cu/Sn ì‹œí™© vs ì—…ì²´ë³„ ë°œì£¼ë‹¨ê°€ íŠ¸ë Œë“œ</p>
                </div>
                <div id="screen3-results" class="hidden"></div>
            </div>
        </div>
    </main>

    <script>
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        //  PRD v2.0 Global State
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        let currentTab = 1;
        let isRunning = false;
        let currentStep = 0;
        let totalSteps = 0;
        let expandedRow = null;
        let chartInstances = {};

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        //  Utility Functions
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function fmt(n) {
            if (n === null || n === undefined || isNaN(n)) return '-';
            return Math.round(n).toLocaleString('ko-KR');
        }

        function sleep(ms) {
            return new Promise(r => setTimeout(r, ms));
        }

        // PRD: íƒ€ì´í•‘ íš¨ê³¼ (LLM ìŠ¤íŠ¸ë¦¬ë°)
        async function typeText(element, text, speed = 25) {
            element.classList.add('typing-cursor');
            let i = 0;
            const len = text.length;
            while (i < len) {
                const chunk = text.substring(i, Math.min(i + 3, len));
                element.textContent += chunk;
                i += 3;
                if (i % 9 === 0) await sleep(speed);
            }
            element.classList.remove('typing-cursor');
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        //  PRD v2.0 Progress Bar
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function setProgress(percent, stepText) {
            document.getElementById('progressFill').style.width = percent + '%';
            document.getElementById('progressStep').textContent = stepText;
            document.getElementById('progressPercent').textContent = percent + '%';
        }

        function updateStepCount(current, total) {
            currentStep = current;
            totalSteps = total;
            document.getElementById('stepCount').textContent = `${current} / ${total} ë‹¨ê³„`;
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        //  PRD v2.0 Agent Panel Functions
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function clearAgentPanel() {
            document.getElementById('agentPanel').innerHTML = '';
            setProgress(0, 'ëŒ€ê¸° ì¤‘');
            updateStepCount(0, 0);
        }

        async function addAgentCard(type, content, options = {}) {
            const panel = document.getElementById('agentPanel');
            const card = document.createElement('div');
            card.className = `agent-card ${type} slide-in-left`;
            card.dataset.cardId = Date.now();
            
            let icon, iconClass, title;
            switch(type) {
                case 'data':
                    icon = 'fa-database';
                    iconClass = 'text-blue-400';
                    title = options.title || 'ë°ì´í„° ìˆ˜ì§‘';
                    break;
                case 'rule':
                    icon = 'fa-cogs';
                    iconClass = 'text-purple-400';
                    title = options.title || 'ë‹¨ê°€ ì‚°ì¶œ';
                    break;
                case 'search':
                    icon = 'fa-globe';
                    iconClass = 'text-green-400';
                    title = options.title || 'ì›¹ê²€ìƒ‰';
                    break;
                case 'llm':
                    icon = 'fa-brain';
                    iconClass = 'text-orange-400';
                    title = options.title || 'AI ë¶„ì„';
                    break;
                case 'result-good':
                case 'result-normal':
                case 'result-bad':
                    icon = 'fa-flag-checkered';
                    iconClass = type === 'result-good' ? 'text-green-400' : 
                               (type === 'result-bad' ? 'text-red-400' : 'text-yellow-400');
                    title = options.title || 'íŒì • ê²°ê³¼';
                    break;
                default:
                    icon = 'fa-info-circle';
                    iconClass = 'text-gray-400';
                    title = options.title || 'ì •ë³´';
            }
            
            const statusHtml = options.loading 
                ? '<span class="spinner"></span>' 
                : (options.badge || '<i class="fas fa-check text-green-400"></i>');
            
            card.innerHTML = `
                <div class="flex items-center justify-between mb-2">
                    <span class="text-xs font-semibold flex items-center gap-2">
                        <i class="fas ${icon} ${iconClass} card-icon"></i>
                        ${title}
                    </span>
                    <span class="card-status">${statusHtml}</span>
                </div>
                <div class="card-content text-sm text-gray-300 leading-relaxed" id="content-${card.dataset.cardId}"></div>
            `;
            
            panel.appendChild(card);
            panel.scrollTop = panel.scrollHeight;
            
            const contentEl = card.querySelector('.card-content');
            
            if (options.typing) {
                await typeText(contentEl, content, options.speed || 20);
            } else {
                contentEl.innerHTML = content;
            }
            
            // ë¡œë”© ì™„ë£Œ ì‹œ ìŠ¤í”¼ë„ˆ â†’ ì²´í¬
            if (options.loading) {
                await sleep(options.delay || 600);
                const status = card.querySelector('.card-status');
                if (status) status.innerHTML = '<i class="fas fa-check text-green-400"></i>';
            }
            
            await sleep(150);
            return card;
        }

        // PRD: ì™„ë£Œëœ ë‹¨ê³„ ì ‘ê¸°
        function collapseCompleted() {
            const cards = document.querySelectorAll('.agent-card:not(.result-good):not(.result-normal):not(.result-bad)');
            cards.forEach((card, idx) => {
                if (idx < cards.length - 2) {
                    card.classList.toggle('collapsed');
                }
            });
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        //  Tab Switching
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        function switchTab(tabNum) {
            if (isRunning) return;
            currentTab = tabNum;
            
            // Agent íŒ¨ë„ ì´ˆê¸°í™”
            clearAgentPanel();
            
            // Progress bar ì´ˆê¸°í™”
            setProgress(0, 'ëŒ€ê¸° ì¤‘');
            updateStepCount(0, 0);
            
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
                btn.classList.add('bg-gray-700/50', 'hover:bg-gray-700');
            });
            const activeBtn = document.querySelector(`[data-tab="${tabNum}"]`);
            activeBtn.classList.add('active');
            activeBtn.classList.remove('bg-gray-700/50', 'hover:bg-gray-700');
            
            document.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden'));
            document.getElementById(`tab${tabNum}`).classList.remove('hidden');
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        //  Demo Mode Entry Point
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        async function startDemo() {
            if (isRunning) return;
            isRunning = true;
            
            const btn = document.getElementById('demoBtn');
            btn.innerHTML = '<span class="spinner"></span> <span>ë¶„ì„ ì¤‘...</span>';
            btn.disabled = true;
            btn.classList.add('opacity-70', 'cursor-not-allowed');
            
            clearAgentPanel();
            
            try {
                if (currentTab === 1) {
                    await runScreen1Demo();
                } else if (currentTab === 2) {
                    await runScreen2Demo();
                } else if (currentTab === 3) {
                    await runScreen3Demo();
                }
            } catch (err) {
                console.error(err);
                await addAgentCard('result-bad', `âŒ ì˜¤ë¥˜ ë°œìƒ: ${err.message}`, { title: 'ì˜¤ë¥˜' });
            }
            
            btn.innerHTML = '<i class="fas fa-play"></i> <span>ë¶„ì„ ì‹¤í–‰</span>';
            btn.disabled = false;
            btn.classList.remove('opacity-70', 'cursor-not-allowed');
            isRunning = false;
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        //  Screen 1: PR ê±´ ìµœì  ì¶”ì²œ ë‹¨ê°€ ì œì•ˆ (PRD v2.0)
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        async function runScreen1Demo() {
            updateStepCount(0, 6);
            
            // Step 1: ë°ì´í„° ìˆ˜ì§‘
            setProgress(10, 'ë‹¨ê°€í…Œì´ë¸” ì¡°íšŒ');
            updateStepCount(1, 6);
            
            await addAgentCard('data', '', { loading: true, title: 'íƒì… ë‹¨ê°€í…Œì´ë¸” ì¡°íšŒ', delay: 700 });
            document.querySelector('.agent-card.data:last-child .card-content').innerHTML = 
                '<div class="mono text-xs">â†’ 482ê±´ ë¡œë“œ ì™„ë£Œ (BODY2, ì˜µì…˜ë‹¨ê°€ í¬í•¨)</div>';
            
            await addAgentCard('data', '', { loading: true, title: 'íƒì… ë°œì£¼ì‹¤ì  ì¡°íšŒ', delay: 900 });
            document.querySelector('.agent-card.data:last-child .card-content').innerHTML = 
                '<div class="mono text-xs">â†’ 36,960ê±´ ë¡œë“œ ì™„ë£Œ (2.1s)</div>';
            
            // Step 2: PR ìƒ˜í”Œ ì„ íƒ
            setProgress(25, 'PR ìƒ˜í”Œ ì¶”ì¶œ');
            updateStepCount(2, 6);
            
            await addAgentCard('rule', `
                <div class="space-y-1 text-xs">
                    <div>â€¢ ë‹¨ê°€í…Œì´ë¸” ë§¤í•‘ ê°€ëŠ¥: <span class="text-green-400 font-semibold">7ê±´</span></div>
                    <div>â€¢ ë¯¸ë§¤í•‘ (ì‹¤ì  ê¸°ì¤€): <span class="text-yellow-400 font-semibold">3ê±´</span></div>
                    <div>â€¢ í•©ê³„: <span class="text-white font-semibold">10ê±´</span> ì„ íƒ</div>
                </div>
            `, { title: 'PR ìƒ˜í”Œ ì¶”ì¶œ' });
            
            // Step 3: Rule ì ìš©
            setProgress(40, 'ê³„ì•½ë‹¨ê°€ ì‚°ì¶œ');
            updateStepCount(3, 6);
            
            await addAgentCard('rule', `
                <div class="space-y-2 text-xs">
                    <div class="flex items-center gap-2">
                        <span class="badge badge-info">ê¸°ë³¸</span>
                        <span>ë°¸ë¸Œíƒ€ì… ë§¤í•‘ â†’ BODY2 ê¸°ë³¸ë‹¨ê°€</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="badge badge-info">ì˜µì…˜</span>
                        <span>í‚¤ì›Œë“œ ì¶”ì¶œ â†’ ì˜µì…˜ë‹¨ê°€ í•©ì‚° (I/O-P, LOCK ë“±)</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="badge badge-info">í•©ê³„</span>
                        <span>ìˆ˜ëŸ‰ í™˜ì‚° â†’ ê°œë‹¹ ê³„ì•½ë‹¨ê°€</span>
                    </div>
                </div>
            `, { title: 'ê³„ì•½ë‹¨ê°€ ì‚°ì¶œ ê¸°ì¤€' });
            
            // Step 4: ë°œì£¼ì‹¤ì  ë§¤í•‘
            setProgress(55, 'ë°œì£¼ì‹¤ì  ì¡°íšŒ');
            updateStepCount(4, 6);
            
            await addAgentCard('rule', `
                <div class="space-y-2 text-xs">
                    <div class="flex items-center gap-2">
                        <span class="w-2 h-2 rounded-full bg-green-400"></span>
                        <span><b>1ìˆœìœ„:</b> ë°¸ë¸Œíƒ€ì… + ìì¬ë‚´ì—­ 100% ì¼ì¹˜</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="w-2 h-2 rounded-full bg-yellow-400"></span>
                        <span><b>2ìˆœìœ„:</b> ë°¸ë¸Œíƒ€ì…ë§Œ ì¼ì¹˜ â†’ ìµœê·¼ ë°œì£¼ë‹¨ê°€</span>
                    </div>
                </div>
            `, { title: 'ë°œì£¼ì‹¤ì  ê¸°ë°˜ ì˜ˆìƒë‹¨ê°€' });
            
            // API í˜¸ì¶œ
            setProgress(70, 'ê²°ê³¼ ìƒì„±');
            updateStepCount(5, 6);
            
            const res = await fetch('/api/screen1/analyze', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({})
            });
            const data = await res.json();
            
            if (!data.success) throw new Error(data.error || 'ë¶„ì„ ì‹¤íŒ¨');
            
            // ê²°ê³¼ ìš”ì•½ ì¹´ë“œ
            const mappedCount = data.results.filter(r => r.mapped).length;
            const unmappedCount = data.results.length - mappedCount;
            
            const resultType = mappedCount >= unmappedCount * 2 ? 'result-good' : 'result-normal';
            await addAgentCard(resultType, `
                <div class="grid grid-cols-3 gap-3 text-center">
                    <div class="p-2 rounded bg-white/5">
                        <div class="text-lg font-bold text-white">${data.results.length}</div>
                        <div class="text-xs text-gray-400">ì „ì²´ PR</div>
                    </div>
                    <div class="p-2 rounded bg-green-500/10">
                        <div class="text-lg font-bold text-green-400">${mappedCount}</div>
                        <div class="text-xs text-gray-400">ë‹¨ê°€í‘œ ë§¤í•‘</div>
                    </div>
                    <div class="p-2 rounded bg-yellow-500/10">
                        <div class="text-lg font-bold text-yellow-400">${unmappedCount}</div>
                        <div class="text-xs text-gray-400">ì‹¤ì  ê¸°ì¤€</div>
                    </div>
                </div>
            `, { title: 'ë¶„ì„ ì™„ë£Œ', badge: '<span class="badge badge-good">ì™„ë£Œ</span>' });
            
            // Step 6: LLM ë¶„ì„
            setProgress(85, 'AI ì¶”ì²œ ê·¼ê±° ìƒì„±');
            updateStepCount(6, 6);
            
            await addAgentCard('llm', '', { title: 'AI ì¶”ì²œ ê·¼ê±° ìƒì„±', typing: true });
            const llmCard = document.querySelector('.agent-card.llm:last-child .card-content');
            
            // AI ë¶„ì„ í…ìŠ¤íŠ¸ ìƒì„±
            const aiText = generateScreen1AIAnalysis(data.results);
            await typeText(llmCard, aiText, 12);
            
            setProgress(100, 'ì™„ë£Œ');
            
            // ê²°ê³¼ í…Œì´ë¸” ë Œë”ë§
            renderScreen1Results(data.results);
        }

        function generateScreen1AIAnalysis(results) {
            const mapped = results.filter(r => r.mapped);
            const unmapped = results.filter(r => !r.mapped);
            
            let text = `[ë¶„ì„ ìš”ì•½]\n`;
            text += `â€¢ ë‹¨ê°€í…Œì´ë¸” ë§¤í•‘ ì„±ê³µ: ${mapped.length}ê±´ â†’ ê³„ì•½ë‹¨ê°€ ê¸°ì¤€ ì¶”ì²œ\n`;
            text += `â€¢ ë¯¸ë§¤í•‘: ${unmapped.length}ê±´ â†’ ë°œì£¼Ã—90% ê¸°ì¤€ ì¶”ì²œ\n\n`;
            
            text += `[í•µì‹¬ ì¸ì‚¬ì´íŠ¸]\n`;
            
            let savings = 0;
            for (const r of mapped.slice(0, 3)) {
                if (r.rule3_contractPrice && r.recentPrice) {
                    const diff = r.recentPrice - r.rule3_contractPrice;
                    if (diff > 0) {
                        savings += diff;
                        text += `â€¢ ${r.valveType}: ê³„ì•½ë‹¨ê°€ ${fmt(r.rule3_contractPrice)}ì› ì ìš© ì‹œ ${fmt(diff)}ì› ì ˆê°\n`;
                    }
                }
            }
            
            if (savings > 0) {
                text += `\nğŸ’° ì˜ˆìƒ ì ˆê°ì•¡: ${fmt(savings)}ì› (ìƒìœ„ 3ê±´)`;
            }
            
            return text;
        }

        function renderScreen1Results(results) {
            document.getElementById('screen1-intro').classList.add('hidden');
            const container = document.getElementById('screen1-results');
            container.classList.remove('hidden');

            let html = `
            <div class="mb-5">
                <h3 class="text-lg font-bold flex items-center gap-2 mb-2">
                    <i class="fas fa-table text-blue-400"></i>
                    PR ê±´ë³„ ìµœì  ì¶”ì²œ ë‹¨ê°€ ì œì•ˆ
                </h3>
                <p class="text-xs text-gray-500">í–‰ì„ í´ë¦­í•˜ë©´ ìƒì„¸ ë‹¨ê°€ ì‚°ì¶œ ê·¼ê±°ê°€ í¼ì³ì§‘ë‹ˆë‹¤</p>
            </div>
            
            <div class="overflow-x-auto rounded-xl border border-gray-700/50" style="max-height: calc(100vh - 320px);">
                <table class="prd-table">
                    <thead>
                        <tr>
                            <th class="section-header" colspan="2">PR ì„¸ë¶€ ë‚´ì—­</th>
                            <th class="section-header" colspan="3">ê³„ì•½ë‹¨ê°€ (ê¸°ë³¸+ì˜µì…˜)</th>
                            <th class="section-header" colspan="3">ìµœê·¼ë°œì£¼ë‹¨ê°€ (ì‹¤ì )</th>
                            <th class="section-header">ë°œì£¼Ã—90%</th>
                            <th class="section-header" colspan="2">AI ì¶”ì²œ</th>
                        </tr>
                        <tr>
                            <th style="width:60px">PR</th>
                            <th style="min-width:180px">ìì¬ë²ˆí˜¸/ë‚´ì—­</th>
                            <th style="width:90px">BODY2</th>
                            <th style="width:90px">ì˜µì…˜</th>
                            <th style="width:100px" class="highlight">í•©ê³„</th>
                            <th style="width:70px">ì—…ì²´</th>
                            <th style="width:70px">ì¼ì</th>
                            <th style="width:100px">ê¸ˆì•¡</th>
                            <th style="width:100px">ê¸ˆì•¡</th>
                            <th style="width:110px" class="recommend">ì¶”ì²œë‹¨ê°€</th>
                            <th style="width:90px">ê·¼ê±°</th>
                        </tr>
                    </thead>
                    <tbody id="screen1-tbody">`;

            for (let i = 0; i < results.length; i++) {
                const r = results[i];
                const mappedBadge = r.mapped 
                    ? '<span class="inline-block w-2 h-2 rounded-full bg-green-400 mr-1"></span>' 
                    : '<span class="inline-block w-2 h-2 rounded-full bg-yellow-400 mr-1"></span>';
                
                html += `
                    <tr onclick="toggleDetail1(${i}, this)" id="row-${i}">
                        <td class="font-semibold text-blue-300">PR${String(i+1).padStart(3,'0')}</td>
                        <td class="text-left">
                            <div class="flex items-center">
                                ${mappedBadge}
                                <span class="mono text-xs text-blue-300">${r.valveType || '-'}</span>
                            </div>
                            <div class="text-xs text-gray-500 truncate mt-1" style="max-width:170px" title="${r.description}">${r.description || '-'}</div>
                        </td>
                        <td class="text-right price ${r.mapped ? '' : 'text-gray-500'}">${fmt(r.rule1_body2)}</td>
                        <td class="text-right price">${fmt(r.rule2_option)}</td>
                        <td class="text-right price highlight font-semibold">${fmt(r.rule3_contractPrice)}</td>
                        <td class="text-xs">${r.recentOrder?.vendor?.substring(0, 4) || '-'}</td>
                        <td class="text-xs text-gray-400">${r.recentOrder?.date?.substring(5) || '-'}</td>
                        <td class="text-right price">${fmt(r.recentPrice)}</td>
                        <td class="text-right price text-yellow-400">${fmt(r.recent90)}</td>
                        <td class="text-right price recommend">${fmt(r.recommendedPrice)}</td>
                        <td class="text-xs">${r.recommendReason || '-'}</td>
                    </tr>
                    <tr id="detail-${i}" class="hidden">
                        <td colspan="11" class="p-0 bg-transparent">
                            <div class="detail-panel">
                                <div class="grid grid-cols-3 gap-6">
                                    <div>
                                        <h4 class="font-semibold text-blue-400 mb-3 flex items-center gap-2">
                                            <i class="fas fa-route"></i>ë°¸ë¸Œíƒ€ì… ë§¤í•‘
                                        </h4>
                                        <div class="space-y-2 text-xs text-gray-300">
                                            <div class="flex justify-between"><span class="text-gray-500">ì›ë³¸:</span><span class="mono">${r.valveType}</span></div>
                                            <div class="flex justify-between"><span class="text-gray-500">ë§¤í•‘í‚¤:</span><span class="mono">${r.valveTypeBase}</span></div>
                                            <div class="flex justify-between"><span class="text-gray-500">ë§¤í•‘:</span><span class="${r.mapped ? 'text-green-400' : 'text-yellow-400'}">${r.mapped ? 'âœ… ì„±ê³µ' : 'âš ï¸ ë¯¸ë§¤í•‘'}</span></div>
                                            <div class="flex justify-between"><span class="text-gray-500">ìˆ˜ëŸ‰:</span><span>${r.quantity}ê°œ ${r.tableQty ? `(í‘œ: ${r.tableQty}ê°œ)` : ''}</span></div>
                                        </div>
                                    </div>
                                    <div>
                                        <h4 class="font-semibold text-purple-400 mb-3 flex items-center gap-2">
                                            <i class="fas fa-cogs"></i>ë‹¨ê°€ ì‚°ì¶œ ê·¼ê±°
                                        </h4>
                                        <div class="space-y-2 text-xs text-gray-300">
                                            <div class="flex justify-between"><span class="text-gray-500">ê¸°ë³¸ë‹¨ê°€ (BODY2):</span><span class="mono">${r.mapped ? fmt(r.rule1_body2) + 'ì›' : 'ë¯¸ë§¤í•‘'}</span></div>
                                            <div class="flex justify-between"><span class="text-gray-500">ì˜µì…˜ë‹¨ê°€:</span><span class="mono">${fmt(r.rule2_option)}ì›</span></div>
                                            <div class="flex justify-between"><span class="text-gray-500">ê³„ì•½ë‹¨ê°€ í•©ê³„:</span><span class="mono font-semibold text-yellow-400">${fmt(r.rule3_contractPrice)}ì›</span></div>
                                        </div>
                                    </div>
                                    <div>
                                        <h4 class="font-semibold text-orange-400 mb-3 flex items-center gap-2">
                                            <i class="fas fa-history"></i>ë°œì£¼ì‹¤ì 
                                        </h4>
                                        <div class="space-y-2 text-xs text-gray-300">
                                            ${r.recentOrder ? `
                                                <div class="flex justify-between"><span class="text-gray-500">ìˆœìœ„:</span><span>${r.recentOrder.rank}</span></div>
                                                <div class="flex justify-between"><span class="text-gray-500">ì—…ì²´:</span><span>${r.recentOrder.vendor}</span></div>
                                                <div class="flex justify-between"><span class="text-gray-500">ì¼ì:</span><span>${r.recentOrder.date}</span></div>
                                                <div class="flex justify-between"><span class="text-gray-500">ê¸ˆì•¡:</span><span class="mono">${fmt(r.recentPrice)}ì›</span></div>
                                            ` : '<div class="text-gray-500">ë°œì£¼ì‹¤ì  ì—†ìŒ</div>'}
                                        </div>
                                    </div>
                                </div>
                                ${r.rule2_optionDetails?.length ? `
                                <div class="mt-4 pt-4 border-t border-gray-700">
                                    <span class="text-xs text-gray-400"><i class="fas fa-tags mr-1"></i>ì˜µì…˜ ìƒì„¸: <span class="text-purple-300">${r.rule2_optionDetails.join(', ')}</span></span>
                                </div>
                                ` : ''}
                            </div>
                        </td>
                    </tr>`;
            }

            html += `</tbody></table></div>`;
            container.innerHTML = html;
        }

        function toggleDetail1(index, row) {
            const detailRow = document.getElementById(`detail-${index}`);
            const isHidden = detailRow.classList.contains('hidden');
            
            document.querySelectorAll('[id^="detail-"]').forEach(el => el.classList.add('hidden'));
            document.querySelectorAll('#screen1-tbody tr').forEach(el => el.classList.remove('expanded'));
            
            if (isHidden) {
                detailRow.classList.remove('hidden');
                row.classList.add('expanded');
            }
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        //  Screen 2: í˜‘ë ¥ì‚¬ ê²¬ì  ì ì •ì„± ê²€ì¦ (PRD v2.0)
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        async function runScreen2Demo() {
            updateStepCount(0, 5);
            
            // Step 1: ë°ì´í„° ìˆ˜ì§‘
            setProgress(15, 'ê²¬ì  ë°ì´í„° ì¡°íšŒ');
            updateStepCount(1, 5);
            
            await addAgentCard('data', '', { loading: true, title: 'í˜‘ë ¥ì‚¬ ê²¬ì  ì¡°íšŒ', delay: 600 });
            document.querySelector('.agent-card.data:last-child .card-content').innerHTML = 
                '<div class="mono text-xs">â†’ 159ê±´ ë¡œë“œ ì™„ë£Œ</div>';
            
            // Step 2: ì „ì²˜ë¦¬
            setProgress(30, 'ë°¸ë¸Œíƒ€ì… ë§¤í•‘');
            updateStepCount(2, 5);
            
            await addAgentCard('rule', `
                <div class="space-y-1 text-xs">
                    <div>âš ï¸ ê²¬ì ì— ë°¸ë¸Œíƒ€ì… ì—†ìŒ â†’ ë°œì£¼ì‹¤ì ì—ì„œ ë§¤í•‘ í•„ìš”</div>
                    <div>â€¢ ìì¬ë²ˆí˜¸ ì• 4ìë¦¬ ì œê±° â†’ mat_core ì¶”ì¶œ</div>
                    <div>â€¢ ì‹¤ì  ë”•ì…”ë„ˆë¦¬ì—ì„œ Valve Type ë§¤í•‘</div>
                </div>
            `, { title: 'ì „ì²˜ë¦¬ - ë°¸ë¸Œíƒ€ì… ë§¤í•‘' });
            
            await addAgentCard('data', `
                <div class="flex items-center gap-3">
                    <div class="text-2xl font-bold text-green-400">79%</div>
                    <div class="text-xs text-gray-400">ë§¤í•‘ ì„±ê³µë¥ <br>(126/159ê±´)</div>
                </div>
            `, { title: 'ë§¤í•‘ ì™„ë£Œ' });
            
            // Step 3: ì ì •ì„± ê²€ì¦
            setProgress(50, 'ì ì •ì„± íŒì •');
            updateStepCount(3, 5);
            
            await addAgentCard('rule', `
                <div class="space-y-2 text-xs">
                    <div class="flex items-center gap-2">
                        <span class="badge badge-good">âœ… ìš°ìˆ˜</span>
                        <span>ë°œì£¼Ã—90% â‰¥ ê²¬ì ê°€</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="badge badge-normal">ğŸ”¶ ë³´í†µ</span>
                        <span>ë°œì£¼/ê³„ì•½ â‰¥ ê²¬ì ê°€</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="badge badge-bad">âŒ ë¶€ì ì ˆ</span>
                        <span>ê¸°ì¤€ ë¯¸ë‹¬</span>
                    </div>
                </div>
            `, { title: 'ì ì •ì„± íŒì • ê¸°ì¤€' });
            
            // API í˜¸ì¶œ
            setProgress(70, 'ê²°ê³¼ ì§‘ê³„');
            updateStepCount(4, 5);
            
            const res = await fetch('/api/screen2/analyze', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({})
            });
            const data = await res.json();
            
            if (!data.success) throw new Error(data.error || 'ë¶„ì„ ì‹¤íŒ¨');
            
            // ê²°ê³¼ ìš”ì•½
            const resultType = data.counts.ë¶€ì ì ˆ < data.total * 0.1 ? 'result-good' 
                : (data.counts.ë¶€ì ì ˆ < data.total * 0.2 ? 'result-normal' : 'result-bad');
            
            await addAgentCard(resultType, `
                <div class="grid grid-cols-3 gap-3 text-center">
                    <div class="p-2 rounded bg-green-500/20">
                        <div class="text-lg font-bold text-green-400">${data.counts.ìš°ìˆ˜}</div>
                        <div class="text-xs text-gray-400">ìš°ìˆ˜</div>
                    </div>
                    <div class="p-2 rounded bg-yellow-500/20">
                        <div class="text-lg font-bold text-yellow-400">${data.counts.ë³´í†µ}</div>
                        <div class="text-xs text-gray-400">ë³´í†µ</div>
                    </div>
                    <div class="p-2 rounded bg-red-500/20">
                        <div class="text-lg font-bold text-red-400">${data.counts.ë¶€ì ì ˆ}</div>
                        <div class="text-xs text-gray-400">ë¶€ì ì ˆ</div>
                    </div>
                </div>
            `, { title: 'ì ì •ì„± ë¶„í¬', badge: '<span class="badge badge-good">ì™„ë£Œ</span>' });
            
            // Step 5: LLM ë¶„ì„
            setProgress(85, 'ë¶€ì ì ˆ ê±´ ë¶„ì„');
            updateStepCount(5, 5);
            
            const badItems = data.results.filter(r => r.assessment === 'ë¶€ì ì ˆ');
            if (badItems.length > 0) {
                await addAgentCard('llm', '', { title: 'ë¶€ì ì ˆ ê±´ ì›ì¸ ë¶„ì„', typing: true });
                const llmCard = document.querySelector('.agent-card.llm:last-child .card-content');
                
                let llmText = `[ë¶€ì ì ˆ ${badItems.length}ê±´ ë¶„ì„]\n`;
                for (const item of badItems.slice(0, 3)) {
                    const gap = item.gapPercent ? `+${item.gapPercent.toFixed(0)}%` : '';
                    llmText += `â€¢ ${item.materialNo}: ${fmt(item.quotePrice)}ì› vs ${fmt(item.recentPrice)}ì› (${gap})\n`;
                }
                llmText += `\nğŸ’¡ í˜‘ìƒ ì „ëµ: ìµœê·¼ë°œì£¼Ã—90% ê¸°ì¤€ ì¬ê²¬ì  ìš”ì²­ ê¶Œì¥`;
                
                await typeText(llmCard, llmText, 15);
            }
            
            setProgress(100, 'ì™„ë£Œ');
            
            renderScreen2Results(data);
        }

        function renderScreen2Results(data) {
            document.getElementById('screen2-intro').classList.add('hidden');
            const container = document.getElementById('screen2-results');
            container.classList.remove('hidden');

            const goodPct = (data.counts.ìš°ìˆ˜ / data.total * 100).toFixed(1);
            const normalPct = (data.counts.ë³´í†µ / data.total * 100).toFixed(1);
            const badPct = (data.counts.ë¶€ì ì ˆ / data.total * 100).toFixed(1);

            let html = `
            <!-- ìƒë‹¨: KPI ëŒ€ì‹œë³´ë“œ -->
            <div class="grid grid-cols-4 gap-4 mb-6">
                <div class="col-span-1">
                    <div class="chart-container h-full flex items-center justify-center">
                        <canvas id="donutChart" height="130"></canvas>
                    </div>
                </div>
                <div class="col-span-3 grid grid-cols-3 gap-4">
                    <div class="kpi-card border-l-4 border-green-500">
                        <div class="kpi-value text-green-400">${data.counts.ìš°ìˆ˜}</div>
                        <div class="text-xs text-gray-400 mt-1">âœ… ìš°ìˆ˜ (${goodPct}%)</div>
                        <div class="text-xs text-green-400/70 mt-2">ì¦‰ì‹œ ë°œì£¼ ì¶”ì²œ</div>
                    </div>
                    <div class="kpi-card border-l-4 border-yellow-500">
                        <div class="kpi-value text-yellow-400">${data.counts.ë³´í†µ}</div>
                        <div class="text-xs text-gray-400 mt-1">ğŸ”¶ ë³´í†µ (${normalPct}%)</div>
                        <div class="text-xs text-yellow-400/70 mt-2">êµ¬ë§¤ ê°€ëŠ¥</div>
                    </div>
                    <div class="kpi-card border-l-4 border-red-500">
                        <div class="kpi-value text-red-400">${data.counts.ë¶€ì ì ˆ}</div>
                        <div class="text-xs text-gray-400 mt-1">âŒ ë¶€ì ì ˆ (${badPct}%)</div>
                        <div class="text-xs text-red-400/70 mt-2">ì¬í˜‘ìƒ í•„ìš”</div>
                    </div>
                </div>
            </div>

            <!-- ì¤‘ë‹¨: ê²¬ì  í…Œì´ë¸” -->
            <div class="overflow-x-auto rounded-xl border border-gray-700/50 mb-6" style="max-height: 300px;">
                <table class="prd-table">
                    <thead>
                        <tr>
                            <th style="min-width:160px">ìì¬ë²ˆí˜¸/ë‚´ì—­</th>
                            <th style="width:100px">ê²¬ì ê°€</th>
                            <th style="width:100px">ìµœê·¼ë°œì£¼</th>
                            <th style="width:100px">ë°œì£¼Ã—90%</th>
                            <th style="width:100px">ê³„ì•½ë‹¨ê°€</th>
                            <th style="width:80px">ì´ˆê³¼ìœ¨</th>
                            <th style="width:90px">íŒì •</th>
                        </tr>
                    </thead>
                    <tbody>`;

            for (const r of data.results.slice(0, 30)) {
                const badgeClass = r.assessment === 'ìš°ìˆ˜' ? 'badge-good' 
                    : r.assessment === 'ë¶€ì ì ˆ' ? 'badge-bad' : 'badge-normal';
                const gapStr = r.gapPercent !== null ? `${r.gapPercent > 0 ? '+' : ''}${r.gapPercent.toFixed(0)}%` : '-';
                const gapColor = r.gapPercent > 10 ? 'text-red-400 font-semibold' : (r.gapPercent < -5 ? 'text-green-400' : '');

                html += `
                    <tr>
                        <td class="text-left">
                            <div class="mono text-xs text-blue-300">${r.materialNo}</div>
                            <div class="text-xs text-gray-500 truncate" style="max-width:150px">${r.description}</div>
                        </td>
                        <td class="text-right price">${fmt(r.quotePrice)}</td>
                        <td class="text-right price">${fmt(r.recentPrice)}</td>
                        <td class="text-right price text-yellow-400">${fmt(r.recent90)}</td>
                        <td class="text-right price">${fmt(r.contractPrice)}</td>
                        <td class="${gapColor}">${gapStr}</td>
                        <td><span class="badge ${badgeClass}">${r.assessmentLabel}</span></td>
                    </tr>`;
            }

            html += `</tbody></table></div>`;
            
            // ë¶€ì ì ˆ ê±´ ìƒì„¸
            const badItems = data.results.filter(r => r.assessment === 'ë¶€ì ì ˆ');
            if (badItems.length > 0) {
                html += `
                <div class="bg-gradient-to-r from-red-500/10 to-red-500/5 border border-red-500/30 rounded-xl p-5">
                    <h4 class="font-semibold text-red-400 mb-4 flex items-center gap-2">
                        <i class="fas fa-exclamation-triangle"></i>
                        ë¶€ì ì ˆ ê±´ ì§‘ì¤‘ ë¶„ì„ (${badItems.length}ê±´)
                    </h4>
                    <div class="space-y-3">
                        ${badItems.slice(0, 5).map(item => {
                            const gap = item.gapPercent ? `+${item.gapPercent.toFixed(0)}%` : '';
                            return `
                            <div class="flex items-center justify-between p-3 rounded-lg bg-red-500/10">
                                <div>
                                    <span class="mono text-xs text-red-300">${item.materialNo}</span>
                                    <span class="text-xs text-gray-500 ml-2">${item.description?.substring(0, 30)}...</span>
                                </div>
                                <div class="text-right">
                                    <span class="text-xs">ê²¬ì  <span class="mono text-white">${fmt(item.quotePrice)}</span></span>
                                    <span class="text-xs text-gray-500 mx-2">vs</span>
                                    <span class="text-xs">ë°œì£¼ <span class="mono text-white">${fmt(item.recentPrice)}</span></span>
                                    <span class="badge badge-bad ml-2">${gap}</span>
                                </div>
                            </div>`;
                        }).join('')}
                    </div>
                    <div class="mt-4 pt-4 border-t border-red-500/20 text-sm text-gray-400">
                        ğŸ’¡ <span class="text-yellow-400">í˜‘ìƒ ì „ëµ:</span> ìµœê·¼ë°œì£¼Ã—90% ê¸°ì¤€ ì¬ê²¬ì  ìš”ì²­ ê¶Œì¥
                    </div>
                </div>`;
            }
            
            container.innerHTML = html;
            
            // ë„ë„› ì°¨íŠ¸
            setTimeout(() => {
                if (chartInstances.donut) chartInstances.donut.destroy();
                const ctx = document.getElementById('donutChart')?.getContext('2d');
                if (ctx) {
                    chartInstances.donut = new Chart(ctx, {
                        type: 'doughnut',
                        data: {
                            labels: ['ìš°ìˆ˜', 'ë³´í†µ', 'ë¶€ì ì ˆ'],
                            datasets: [{
                                data: [data.counts.ìš°ìˆ˜, data.counts.ë³´í†µ, data.counts.ë¶€ì ì ˆ],
                                backgroundColor: ['rgba(16, 185, 129, 0.8)', 'rgba(245, 158, 11, 0.8)', 'rgba(239, 68, 68, 0.8)'],
                                borderColor: ['#10b981', '#f59e0b', '#ef4444'],
                                borderWidth: 2
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: { display: false }
                            },
                            cutout: '70%'
                        }
                    });
                }
            }, 100);
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        //  Screen 3: ì‹œí™© ë¶„ì„ (PRD v2.0)
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        async function runScreen3Demo() {
            updateStepCount(0, 5);
            
            // Step 1: ë‚´ë¶€ ë°ì´í„° ìš”ì•½
            setProgress(15, 'BCë°¸ë¸Œ ë°ì´í„° í•„í„°ë§');
            updateStepCount(1, 5);
            
            await addAgentCard('data', '', { loading: true, title: 'BCë°¸ë¸Œ (VGBARR240AT) í•„í„°ë§', delay: 800 });
            document.querySelector('.agent-card.data:last-child .card-content').innerHTML = `
                <div class="space-y-1 text-xs">
                    <div>â€¢ LOCK ì œì™¸, TR ëìë¦¬ í•„í„°</div>
                    <div>â€¢ ê²°ê³¼: <span class="text-green-400 font-semibold">431ê±´</span> ì¶”ì¶œ</div>
                </div>
            `;
            
            // Step 2: ì›¹ê²€ìƒ‰ (LME ì‹œí™©)
            setProgress(35, 'LME ì‹œí™© ìˆ˜ì§‘');
            updateStepCount(2, 5);
            
            await addAgentCard('search', '', { title: 'LME ì‹œí™© ìˆ˜ì§‘', typing: true });
            const searchCard = document.querySelector('.agent-card.search:last-child .card-content');
            await typeText(searchCard, 'ğŸ” Query: "LME copper tin price 2025 monthly average USD"', 30);
            await sleep(400);
            
            await addAgentCard('search', `
                <div class="grid grid-cols-2 gap-4">
                    <div class="p-2 rounded bg-orange-500/10 text-center">
                        <div class="text-lg font-bold text-orange-400">+31%</div>
                        <div class="text-xs text-gray-400">Cu (êµ¬ë¦¬)</div>
                        <div class="text-xs text-gray-500">8,978 â†’ 11,791</div>
                    </div>
                    <div class="p-2 rounded bg-yellow-500/10 text-center">
                        <div class="text-lg font-bold text-yellow-400">+40%</div>
                        <div class="text-xs text-gray-400">Sn (ì£¼ì„)</div>
                        <div class="text-xs text-gray-500">26,339 â†’ 36,876</div>
                    </div>
                </div>
                <div class="text-xs text-gray-500 mt-2">* Fallback: LME_CuSn_Monthly_2025.xlsx</div>
            `, { title: 'LME ì‹œí™© ë°ì´í„°' });
            
            // Step 3: íŠ¸ë Œë“œ ë¹„êµ
            setProgress(55, 'íŠ¸ë Œë“œ ë¹„êµ');
            updateStepCount(3, 5);
            
            await addAgentCard('rule', `
                <div class="space-y-1 text-xs">
                    <div>âœ… 4ê°œì›” ì‹œì°¨ ì ìš© (ì›ì¬ë£Œ â†’ ì—…ì²´ë‹¨ê°€)</div>
                    <div>âœ… Cu+Sn ê°€ì¤‘ë‹¨ê°€: Cu 88% + Sn 12%</div>
                    <div>âœ… ì›ì¬ë£Œ ë¹„ì¤‘ 80% ì ìš©</div>
                    <div class="text-gray-400 mt-1">ì˜ˆ: 1ì›” ì›ì¬ë£Œ â†’ 5ì›” ì—…ì²´ ë‹¨ê°€</div>
                </div>
            `, { title: 'íŠ¸ë Œë“œ ë¹„êµ (4ê°œì›” ì‹œì°¨)' });
            
            // API í˜¸ì¶œ
            setProgress(70, 'ì ì •ì„± íŒì •');
            updateStepCount(4, 5);
            
            const res = await fetch('/api/screen3/analyze', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({})
            });
            const data = await res.json();
            
            if (!data.success) throw new Error(data.error || 'ë¶„ì„ ì‹¤íŒ¨');
            
            const ac = data.assessmentCounts;
            const resultType = ac.Good >= ac.Bad ? 'result-good' : (ac.Bad > ac.Good * 2 ? 'result-bad' : 'result-normal');
            
            await addAgentCard(resultType, `
                <div class="grid grid-cols-3 gap-3 text-center">
                    <div class="p-2 rounded bg-green-500/20">
                        <div class="text-lg font-bold text-green-400">${ac.Good}</div>
                        <div class="text-xs text-gray-400">Good</div>
                    </div>
                    <div class="p-2 rounded bg-yellow-500/20">
                        <div class="text-lg font-bold text-yellow-400">${ac.Normal}</div>
                        <div class="text-xs text-gray-400">Normal</div>
                    </div>
                    <div class="p-2 rounded bg-red-500/20">
                        <div class="text-lg font-bold text-red-400">${ac.Bad}</div>
                        <div class="text-xs text-gray-400">Bad</div>
                    </div>
                </div>
            `, { title: 'ì›”ë³„ ì ì •ì„± íŒì •', badge: '<span class="badge badge-good">ì™„ë£Œ</span>' });
            
            // Step 5: LLM ì¢…í•© ë¶„ì„
            setProgress(85, 'ì¢…í•© ë¶„ì„');
            updateStepCount(5, 5);
            
            await addAgentCard('llm', '', { title: 'ì¢…í•© ë¶„ì„', typing: true });
            const llmCard = document.querySelector('.agent-card.llm:last-child .card-content');
            
            const badMonths = Object.entries(data.assessments)
                .filter(([_, v]) => v.label === 'Bad')
                .map(([m, _]) => m + 'ì›”');
            
            const llmText = `[ì—…ì²´ í–‰ë™ íŒ¨í„´]
ì›ê´‘ë°¸ë¸Œ: ì‹œí™© +${data.summary.cuYearChange}%(Cu) ìƒìŠ¹ì—ë„ ë‹¨ê°€ ì•ˆì •. ë³´ìˆ˜ì  ê°€ê²© ì „ëµ.

[ë¦¬ìŠ¤í¬]
Bad íŒì • ${ac.Bad}ê°œì›” (${badMonths.join(', ') || 'ì—†ìŒ'}) - ì‹œí™© í•˜ë½ë¶„ ë¯¸ë°˜ì˜.

[êµ¬ë§¤ ì „ëµ]
â€¢ ë‹¨ê¸°: Bad ì›” ì†Œê¸‰ ì¸í•˜ 3~5% ìš”ì²­
â€¢ ì¤‘ê¸°: LME ì—°ë™ ê³„ì•½ ì¡°í•­ ë„ì…
â€¢ ì¥ê¸°: ë³µìˆ˜ ì—…ì²´ í¬íŠ¸í´ë¦¬ì˜¤ í™•ëŒ€`;
            
            await typeText(llmCard, llmText, 12);
            
            setProgress(100, 'ì™„ë£Œ');
            
            renderScreen3Results(data);
        }

        function renderScreen3Results(data) {
            document.getElementById('screen3-intro').classList.add('hidden');
            const container = document.getElementById('screen3-results');
            container.classList.remove('hidden');

            const ac = data.assessmentCounts;
            const badMonths = Object.entries(data.assessments)
                .filter(([_, v]) => v.label === 'Bad')
                .map(([m, _]) => m + 'ì›”');

            let html = `
            <!-- KPI ì¹´ë“œ -->
            <div class="grid grid-cols-4 gap-4 mb-6">
                <div class="kpi-card">
                    <div class="kpi-value text-orange-400">+${data.summary.cuYearChange}%</div>
                    <div class="text-xs text-gray-400 mt-1">Cu (êµ¬ë¦¬) ì—°ê°„</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-value text-yellow-400">+${data.summary.snYearChange}%</div>
                    <div class="text-xs text-gray-400 mt-1">Sn (ì£¼ì„) ì—°ê°„</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-value text-blue-400">${data.summary.totalOrders}</div>
                    <div class="text-xs text-gray-400 mt-1">ë¶„ì„ ê±´ìˆ˜</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-value ${ac.Good >= ac.Bad ? 'text-green-400' : 'text-red-400'}">
                        ${ac.Good >= ac.Bad ? 'ì–‘í˜¸' : 'ì£¼ì˜'}
                    </div>
                    <div class="text-xs text-gray-400 mt-1">ì „ì²´ íŒì •</div>
                </div>
            </div>

            <!-- í•µì‹¬ ì°¨íŠ¸: ì‹œí™© vs ë°œì£¼ íŠ¸ë Œë“œ -->
            <div class="chart-container mb-6">
                <div class="flex items-center justify-between mb-4">
                    <h4 class="font-semibold text-sm flex items-center gap-2">
                        <i class="fas fa-chart-line text-blue-400"></i>
                        ì›ì¬ë£Œ ì‹œí™© vs ì—…ì²´ ë°œì£¼ë‹¨ê°€ (4ê°œì›” ì‹œì°¨)
                    </h4>
                    <span class="text-xs text-gray-500">ì›ì¬ë£Œ: Cu+Sn ê°€ì¤‘ (USD/í†¤) | ë‹¨ê°€: KRW</span>
                </div>
                <canvas id="trendChart" height="200"></canvas>
                <div class="mt-2 text-xs text-gray-500 text-center">
                    ğŸ“Œ ì›ì¬ë£Œ 1ì›” ì‹œí™© â†’ ì—…ì²´ 5ì›” ë‹¨ê°€ ë°˜ì˜ (4ê°œì›” ì‹œì°¨ ì ìš©)
                </div>
            </div>

            <!-- ì›”ë³„ ì ì •ì„± íƒ€ì„ë¼ì¸ -->
            <div class="chart-container mb-6">
                <h4 class="font-semibold text-sm mb-4 flex items-center gap-2">
                    <i class="fas fa-calendar-alt text-purple-400"></i>
                    ì›”ë³„ ì ì •ì„± íƒ€ì„ë¼ì¸ (4ê°œì›” ì‹œì°¨ ê¸°ì¤€)
                </h4>
                <div class="flex justify-between items-center px-4">
                    ${Object.entries(data.assessments).map(([m, v]) => {
                        const dotClass = v.label.toLowerCase();
                        const lagInfo = v.lagMonth ? `(${v.lagMonth}ì›” ì‹œí™© ê¸°ì¤€)` : '';
                        return `
                        <div class="text-center group">
                            <div class="timeline-dot ${dotClass} mb-2 mx-auto" title="${m}ì›”: ${v.label} ${lagInfo}\nì‹œí™© ${v.marketChange > 0 ? '+' : ''}${v.marketChange}% â†’ ë‹¨ê°€ ${v.priceChange > 0 ? '+' : ''}${v.priceChange}%">
                                ${m}
                            </div>
                            <div class="text-xs text-gray-500">${v.label}</div>
                        </div>`;
                    }).join('')}
                </div>
                <div class="mt-4 pt-4 border-t border-gray-700/50 flex justify-center gap-8 text-sm">
                    <span class="flex items-center gap-2"><span class="w-3 h-3 rounded-full bg-green-500"></span> Good: ${ac.Good}</span>
                    <span class="flex items-center gap-2"><span class="w-3 h-3 rounded-full bg-yellow-500"></span> Normal: ${ac.Normal}</span>
                    <span class="flex items-center gap-2"><span class="w-3 h-3 rounded-full bg-red-500"></span> Bad: ${ac.Bad}</span>
                </div>
            </div>

            <!-- Executive Summary -->
            <div class="bg-gradient-to-r from-orange-500/10 via-yellow-500/5 to-orange-500/10 border border-orange-500/30 rounded-xl p-5">
                <h4 class="font-semibold text-orange-400 mb-4 flex items-center gap-2">
                    <i class="fas fa-brain"></i>
                    Executive Summary
                </h4>
                <div class="grid grid-cols-2 gap-6">
                    <div>
                        <h5 class="text-xs text-gray-400 mb-3 font-semibold">ğŸ’¡ í•µì‹¬ ì¸ì‚¬ì´íŠ¸</h5>
                        <div class="space-y-2 text-sm text-gray-300">
                            <p>â€¢ ì‹œí™© <span class="text-orange-400">+${data.summary.cuYearChange}%</span>(Cu) / <span class="text-yellow-400">+${data.summary.snYearChange}%</span>(Sn) ìƒìŠ¹</p>
                            <p>â€¢ <span class="text-green-400">Good ${ac.Good}ê°œì›”</span> â†’ ì‹œí™© ëŒ€ë¹„ ìœ ë¦¬í•œ êµ¬ë§¤ êµ¬ì¡°</p>
                            <p>â€¢ ê´´ë¦¬ ì˜ì—­ = êµ¬ë§¤ ì¸¡ í˜‘ìƒ ë ˆë²„ë¦¬ì§€</p>
                            ${badMonths.length > 0 ? `<p>â€¢ <span class="text-red-400">Bad: ${badMonths.join(', ')}</span> â†’ ì¸í•˜ ë¯¸ë°˜ì˜</p>` : ''}
                        </div>
                    </div>
                    <div>
                        <h5 class="text-xs text-gray-400 mb-3 font-semibold">ğŸ¯ êµ¬ë§¤ ì „ëµ</h5>
                        <div class="space-y-2 text-sm text-gray-300">
                            <p>â€¢ <span class="text-green-400 font-semibold">ë‹¨ê¸°:</span> Bad ì›” ì†Œê¸‰ ì¸í•˜ 3~5% ìš”ì²­</p>
                            <p>â€¢ <span class="text-yellow-400 font-semibold">ì¤‘ê¸°:</span> LME ì—°ë™ ê³„ì•½ ì¡°í•­ ë„ì… (4ê°œì›” ì‹œì°¨)</p>
                            <p>â€¢ <span class="text-blue-400 font-semibold">ì¥ê¸°:</span> ë³µìˆ˜ ì—…ì²´ í¬íŠ¸í´ë¦¬ì˜¤ í™•ëŒ€</p>
                        </div>
                    </div>
                </div>
            </div>`;

            container.innerHTML = html;
            
            // íŠ¸ë Œë“œ ì°¨íŠ¸
            setTimeout(() => drawTrendChart(data), 100);
        }

        function drawTrendChart(data) {
            if (chartInstances.trend) chartInstances.trend.destroy();
            
            const ctx = document.getElementById('trendChart')?.getContext('2d');
            if (!ctx) return;

            const months = data.trendData.map(d => d.monthLabel);
            const cuSnPrices = data.trendData.map(d => d.cuSnPrice);
            const mainVendorPrices = data.trendData.map(d => d.mainVendorPrice);
            
            // 4ê°œì›” ì‹œì°¨ ì ìš©ëœ ì›ì¬ë£Œ ë°ì´í„° (5ì›”ë¶€í„° í‘œì‹œ)
            const laggedCuSnPrices = data.trendData.map((d, i) => {
                // 4ê°œì›” ì „ ì›ì¬ë£Œ ê°’ ì‚¬ìš© (5ì›” ì—…ì²´ë‹¨ê°€ â†’ 1ì›” ì›ì¬ë£Œ)
                const lagIndex = i - 4;
                if (lagIndex >= 0 && data.trendData[lagIndex]) {
                    return data.trendData[lagIndex].cuSnPrice;
                }
                return null;
            });

            chartInstances.trend = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: months,
                    datasets: [
                        {
                            label: 'Cu+Sn ê°€ì¤‘ë‹¨ê°€ (USD/í†¤)',
                            data: cuSnPrices,
                            borderColor: '#f59e0b',
                            backgroundColor: 'rgba(245, 158, 11, 0.15)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4,
                            pointRadius: 6,
                            pointBackgroundColor: '#f59e0b',
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2,
                            pointHoverRadius: 8,
                            yAxisID: 'y-lme',
                        },
                        {
                            label: '4ê°œì›” ì „ ì›ì¬ë£Œ (ì‹œì°¨ ì ìš©)',
                            data: laggedCuSnPrices,
                            borderColor: '#f59e0b',
                            borderWidth: 2,
                            borderDash: [5, 5],
                            fill: false,
                            tension: 0.4,
                            pointRadius: 4,
                            pointBackgroundColor: '#f59e0b',
                            pointBorderColor: '#fff',
                            pointBorderWidth: 1,
                            yAxisID: 'y-lme',
                            spanGaps: false,
                        },
                        {
                            label: data.summary.mainVendor ? data.summary.mainVendor.substring(0, 6) + ' (KRW)' : 'ë°œì£¼ë‹¨ê°€ (KRW)',
                            data: mainVendorPrices,
                            borderColor: '#3b82f6',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4,
                            pointRadius: 6,
                            pointBackgroundColor: '#3b82f6',
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2,
                            pointHoverRadius: 8,
                            spanGaps: true,
                            yAxisID: 'y-vendor',
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    plugins: {
                        legend: { 
                            labels: { 
                                color: '#94a3b8', 
                                font: { size: 11, weight: '500' },
                                usePointStyle: true,
                                padding: 20
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(15, 23, 42, 0.95)',
                            titleColor: '#fff',
                            bodyColor: '#94a3b8',
                            borderColor: 'rgba(255,255,255,0.1)',
                            borderWidth: 1,
                            padding: 14,
                            cornerRadius: 8,
                            callbacks: {
                                label: ctx => {
                                    const val = ctx.raw;
                                    if (val === null || val === undefined) return null;
                                    if (ctx.dataset.yAxisID === 'y-lme') {
                                        return `  ${ctx.dataset.label}: $${val.toLocaleString()}`;
                                    } else {
                                        return `  ${ctx.dataset.label}: â‚©${val.toLocaleString()}`;
                                    }
                                },
                                afterBody: (items) => {
                                    const idx = items[0]?.dataIndex;
                                    if (idx !== undefined && idx >= 4) {
                                        const lagMonth = idx - 3; // 4ê°œì›” ì „
                                        return [`  ğŸ“Œ ë¹„êµ: ${lagMonth}ì›” ì›ì¬ë£Œ â†’ ${idx + 1}ì›” ë‹¨ê°€`];
                                    }
                                    return [];
                                }
                            }
                        }
                    },
                    scales: {
                        x: { 
                            grid: { color: 'rgba(255,255,255,0.05)' }, 
                            ticks: { color: '#64748b', font: { size: 11 } } 
                        },
                        'y-lme': {
                            type: 'linear',
                            position: 'left',
                            grid: { color: 'rgba(255,255,255,0.05)' },
                            ticks: { 
                                color: '#f59e0b', 
                                font: { size: 10 },
                                callback: val => '$' + val.toLocaleString()
                            },
                            title: {
                                display: true,
                                text: 'LME Cu+Sn (USD/í†¤)',
                                color: '#f59e0b',
                                font: { size: 10 }
                            }
                        },
                        'y-vendor': {
                            type: 'linear',
                            position: 'right',
                            grid: { drawOnChartArea: false },
                            ticks: { 
                                color: '#3b82f6', 
                                font: { size: 10 },
                                callback: val => 'â‚©' + (val / 1000).toFixed(0) + 'K'
                            },
                            title: {
                                display: true,
                                text: 'ì—…ì²´ ë‹¨ê°€ (KRW)',
                                color: '#3b82f6',
                                font: { size: 10 }
                            }
                        }
                    }
                }
            });
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        //  Initialize
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                const res = await fetch('/api/health');
                const data = await res.json();
                if (data.status === 'ok') {
                    const d = data.data;
                    document.getElementById('apiStatus').innerHTML = `
                        <span class="w-2 h-2 rounded-full bg-green-400"></span>
                        <span>Python Flask | ${d.priceTable}ê±´, ${d.orders}ê±´</span>
                    `;
                    document.getElementById('apiStatus').className = 
                        'px-4 py-2 bg-green-500/20 text-green-400 rounded-full text-xs font-medium flex items-center gap-2';
                }
            } catch {
                document.getElementById('apiStatus').innerHTML = `
                    <i class="fas fa-exclamation-circle"></i>
                    <span>ì—°ê²° ì‹¤íŒ¨</span>
                `;
                document.getElementById('apiStatus').className = 
                    'px-4 py-2 bg-red-500/20 text-red-400 rounded-full text-xs font-medium flex items-center gap-2';
            }
        });
    </script>
</body>
</html>
